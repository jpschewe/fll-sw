\documentclass[letterpaper,11pt]{report}
\usepackage{fullpage}
\usepackage{float}
\usepackage{alltt}

% FloatBarrier
\usepackage{placeins}

% html links
\usepackage{hyperref}

% algorithm environment for pseudocode 
\usepackage{algorithm}
\usepackage{algorithmic}
%\floatname{algorithm}{}

\title{FLL Tournament Scheduling}
\author{Jon Schewe}

\begin{document}
\maketitle

% Note: the captions on the algorithms are used in the comments for the
% constraints in the Java scheduler and verifier. The portion
% before the ":" is in the Java.
\chapter{FLL Scheduling Constraints}

\section{Definitions}

\begin{algorithm}
\caption{param:0 - Basic definitions and parmaeters}
\begin{algorithmic}
\STATE $SOS$ - the start of the tournament (time 0)
\STATE $TN$ - number of teams at the tournament
\STATE $TN_{N}$ - number of division $N$ teams
\STATE $T_{0}, T_{1}, \dots, T_{n}$ - teams
\STATE $div(T_{0})$ - division of team 0
\STATE $P(T_{0}, 1)$ - performance time for team 0 round 1
\STATE $S(T_{0}, cat)$ - subjective time for team 0 subjective category $cat$
\STATE $changetime = 15$ - time between events
\STATE $performanceDuration = 5$ - amount of time for a performance run for
\STATE $subjectiveDuration = 20$ - amount of time to judge a subjective
category for a team
\COMMENT FIXME: need to figure out how to do constraints for state where we
alternate tables
\end{algorithmic}
\end{algorithm}

\FloatBarrier
\section{Subjective}
%TODO figure out how to put in a lunch break

Everything defined here is true for all subjective judging categories.

\begin{algorithm}
\caption{param:1 - Parameters for subjective judging}
\begin{algorithmic}
\STATE $JN_{cat,div}$ - number of judges for category $cat$ in division
$div$ (typically 1 for regional, more for state)
\STATE $subjectiveStart = SOS$
\STATE $NSubj = 3$ - number of subjective categories
\end{algorithmic}
\end{algorithm}

\FloatBarrier
\section{Performance}
\begin{algorithm}
\caption{param:2 - Performance parameters}
\begin{algorithmic}
\STATE $TableN$ - number of tables
\STATE $performanceStart = SOS + 60$ - give time for teams to get settled
\STATE $PN = ceil(TN / 2) / TableN$ - number of time slots for each
performance round
\STATE $NRounds$ - the number of performance rounds (typically 3)
\STATE $performanceChangetime = 45$ - time between performance rounds
%\STATE $specialPerformanceChangetime = 30$ - time between performance
%rounds for teams with opponents in a different round
\STATE $NDivs = 2$ - number of divisions
\end{algorithmic}
\end{algorithm}

\FloatBarrier
\section{Team Constraints}
These constraints are applied to each team $T$.

FIXME: Need to figure out how to handle the conditional constraints here
\begin{algorithm}
\caption{team:1 - Relationship between each subjective category}
\begin{algorithmic}
\FOR{$category1 \in SubjectiveCategories$}
  \FOR{$category2 \in SubjectiveCategories$}
    \IF{$category1 != category2$}
      \IF{$category1_{end} <= category2_{start}$}
        \STATE $S(T, category1)_{end} + changetime <= S(T, category2)_{start}$
      \ELSE
        \STATE $S(T, category2)_{end} + changetime <= S(T, category1)_{start}$
      \ENDIF
    \ENDIF
  \ENDFOR
\ENDFOR
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{team:2 - Basic performance constraints}
\begin{algorithmic}
\FOR{$round \in 1 \dots NRounds$}
  \STATE $P(T, N)_{end} = P(T, N)_{start} + performanceDuration$
\ENDFOR
\FOR{$round \in 2 \dots NRounds$}
  \STATE $P(T, N-1)_{end} + performanceChangetime <= P(T, N)_{start}$
\ENDFOR
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{team:6 - Basic subjective constraints}
\begin{algorithmic}
\FOR{$cat \in 1 \dots NSubj$}
  \STATE $S(T, cat)_{end} = S(T, cat)_{start} + subjectiveDuration$
\ENDFOR
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{team:3 - Relationships between performance rounds}
\begin{algorithmic}
\FOR{$round \in 2 \dots NRounds$}
  \STATE $P_{{N-1}_{end}} + performanceChangetime <= P_{N_{start}}$ \COMMENT FIXME: Note that if the opponent is in a different round $performanceChangeTime$ needs to be $specialPerformanceChangetime$
\ENDFOR
\end{algorithmic}
\end{algorithm}


\FloatBarrier
FIXME: Need to figure out how to handle conditional here.
\begin{algorithm}
\caption{team:4 - Relationships between subjective categories judging and performance}
\begin{algorithmic}
\FOR{$category \in SubjectiveCategories$}
  \FOR{$round \in 1 \dots nRounds$}
    \IF{$category_{end} <= P_{round_{start}}$}
      \STATE $S(T, category)_{end} + changetime <= P(T, round)_{start}$
    \ELSE
      \STATE $P(T, round)_{end} + changetime <= S(T, category)_{start}$
    \ENDIF
  \ENDFOR
\ENDFOR
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{team:5 - Each team should always compete against other teams}
\begin{algorithmic}
\FOR{$round \in 1 \dots NRounds$}
  \STATE $opp = opponent(P_round)$
  \FOR{$r \in round+1 \dots NRounds$}
    \STATE $opp != opponent(P_r)$
  \ENDFOR
\ENDFOR
\end{algorithmic}
\end{algorithm}


\FloatBarrier
\section{Tournament Constraints}
These constraints pertain to the tournament as a whole.

\begin{algorithm}
\caption{tournament:1 - Limit the number of teams competing on the performance tables at
  the same time}
\begin{algorithmic}

\STATE $teamsAtTime = []$
\FORALL{$T \in teams$}
  \FORALL{$i \in 1 \dots NRounds$}
    \STATE $teamsAtTime[T_{P_{i_{start}}}].append(T)$
  \ENDFOR
  \FORALL{$key \in teamsAtTime.keys()$}
    \IF{$teamsAtTime[key].size() > PN$}
      \STATE BACKTRACK - perhaps can make this a constraint?
    \ENDIF
  \ENDFOR
\ENDFOR

\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{tournament:2 - Limit the number of teams at a subjective judging station}
\begin{algorithmic}
\FORALL{$cat \in SubjectiveCategories$}
  \FORALL{$div \in divisions$}
    \STATE $teamsAtTime_{cat,div} = []$
  \ENDFOR
  \FORALL{$T \in teams$}
    \STATE $teamsAtTime_{cat,div(T)}[T_{cat_{start}}].append(T)$
  \ENDFOR
  \FORALL{$div \in divisions$}
    \FORALL{$key \in teamsAtTime_{cat,div}.keys()$}
      \IF{$teamsAtTime_{cat,div}[key].size() > JN_{cat,div}$}
        \STATE BACKTRACK - perhaps can make this a constraint?
      \ENDIF
    \ENDFOR
  \ENDFOR
\ENDFOR
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{tournament:3 - make sure subjective judging start after $subjectiveStart$}
\begin{algorithmic}
\FORALL{$T \in teams$}
  \FORALL{$cat \in SubjectiveCategories$}
    \STATE $S(T, cat) >= subjectiveStart$
  \ENDFOR
\ENDFOR
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{tournament:4 - make sure performance starts after
$performanceStart$.}
\begin{algorithmic}
\FORALL{$T \in teams$}
  \STATE $P(T, 1) >= performanceStart$
\ENDFOR
\end{algorithmic}
\end{algorithm}

\FloatBarrier
\section{Implementation ideas}
Possible solvers include:
\begin{itemize}
\item \url{http://www.ict.kth.se/courses/ID2204/software.html}{Gecode/J} - isn't native Java so dropped
\item \url{http://www.koalog.com/php/jcs.php}{Koalog} - is commercial
\item \url{http://choco.emn.fr/}{Choco}
\item \url{http://jacop.osolpro.com/}{JaCoP} - implements Minizinc
\end{itemize}

\end{document}
