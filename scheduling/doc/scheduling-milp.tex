\documentclass[letterpaper,11pt]{report}
\usepackage{fullpage}
\usepackage{float}
\usepackage{alltt}

\usepackage[table,usenames,dvipsnames]{xcolor}

% FloatBarrier
\usepackage{placeins}

% html links
\usepackage{hyperref}

% algorithm environment for pseudocode 
\usepackage{algorithm}
\usepackage{algorithmic}
%\floatname{algorithm}{}

% draft - include comments as footnotes and marginpars
\newif\ifdraft
\drafttrue
\ifdraft
\typeout{DRAFT - WITH COMMENTS}
\newcommand{\doccomment}[3]%
{\marginpar{\textcolor{#2}{\bf #1}}%
%\footnote{\textcolor{#2}{#3}}%
\footnote{{\color{#2}#3}}%
}
\else
\typeout{NOT DRAFT - NO COMMENTS}
\newcommand{\doccomment}[3]{}
\fi

% comments for individuals
\newcommand{\jpscomment}[1]%
{\doccomment{SCHEWE}{Bittersweet}{#1}}

\title{FLL Tournament Scheduling (MILP formulation)}
\author{Jon Schewe}

\begin{document}
\maketitle

% Note: the captions on the algorithms are used in the comments for the
% constraints in the Java scheduler and verifier. The portion
% before the ":" is in the Java.
\chapter{FLL Scheduling Constraints}

\section{Parameters}
\begin{itemize}

\item[$TInc$] Number of minutes to a slot, typically 5
\item[$TMax$] Maximum timeslot, typically 8 hours. $(12 * 60)/TInc$
\item[$NSubjective$] The number of subjective judging stations
\item[$NRounds$] The number of performance rounds
\item[$NTables$] The number of performance tables
\item[$NGroups$] The number of judging groups, typically 2

\item[$\alpha^{subjective_{n}}$] Number of time units that a subjective judging
  category takes.

\item[$\alpha^{performance}$] Number of time units that performance judging
  takes. $\alpha^{subjective} = 5 / TInc$ \jpscomment{Note that this
changes when we alternate tables at state}

\item[$ct$] Time to change between judging stations, in time increments. Typically set to 15
  minutes. $ct = 15/TInc$
\item[$pct$] Time between performance runs, in time increments. Typically set to 45
  minutes. $ct = 45/TInc$ \jpscomment{For odd numbered tournaments may be reduced to 30
    minutes}

\end{itemize}

\section{Definitions}
\begin{itemize}

\item[$T$] Time, in increments of $TInc$ minutes, $t \in 1 \dots TMax$

\item[$G_{g}$] The teams in judging group $g$
\item[$N$] All teams = ($G_{1}, G_{2}, \dots, G_{NGroups}$)

\item[$py_{t}^{i,b,s}$] The status of performance table $b$ side $s$ for
at  time $t$ for team $i$. 1 if the table is in use.  

\item[$pz_{t}^{i,b,s}$] 1 if team $i$ is starting performance on table $b$,
  side $s$ at time $t$.

\item[$sy_{t}^{i,n}$] The status of subjective judging station $n$ at time $t$ for team
  $i$, 1 if the station is in use.

\item[$sz_{t}^{i,n}$] 1 if team $i$ is starting judging at subjective
judging station $n$ at time $t$.


\end{itemize}


\section{Constraints}

\subsection{Keep each judging station busy while team $i$ is using it.}

$\sum\limits_{u=1}^{\alpha^{subjective_{n}}} sz_{t-u+1}^{i,n} \le sy_{t}^{i,n}$
\hfill $\forall t \in T,  \forall i \in N,
\forall n \in 1 \dots NSubjective$

$\sum\limits_{u=1}^{\alpha^{performance}} pz_{t-u+1}^{i,b,s} \le py_{t}^{i,b,s}$
\hfill $\forall t \in T, \forall i \in N, \forall b \in 1 \dots NTables,
\forall s \in 1 \dots 2$


\subsection{Note the start of judging at a station upon team transition.}
$sy_{t}^{i,n} - sy_{t-1}^{i,n} \le sz_{t}^{i,n}$
\hfill $\forall t \in T, \forall i \in N,
\forall n \in 1 \dots NSubjective$

$py_{t}^{i,b,s} - py_{t-1}^{i,b,s} \le pz_{t}^{i,b,s}$
\hfill $\forall t \in T, \forall i \in N, \forall b \in 1 \dots NTables,
\forall s \in 1 \dots 2$


\subsection{Ensure that only 1 team ($i$) is at each judging station at a
given time ($t$).}
\label{judging_group_constraint}
$\sum\limits_{i \in G_{g}} sy_{t}^{i,n} \le 1$          
\hfill $\forall t \in T, \forall g \in 1 \dots NGroups,
\forall n \in 1 \dots NSubjective$

$\sum\limits_{i \in N} py_{t}^{i,b,s} \le 1$          
\hfill $\forall t \in T, \forall b \in 1 \dots NTables,
\forall s \in 1 \dots 2$


\subsection{Each team must appear at each subjective station once.}
$\sum\limits_{t \in T} sz_{t}^{i,n} = 1$
\hfill $\forall n \in 1 \dots NSubjective, i \in N$

\subsection{Each team must appear in performance $NRounds$ times.}
$\sum\limits_{t \in T} ( pz_{t}^{i,b,1} + pz_{t}^{i,b,2} ) = NRounds$
\hfill $\forall i \in N, \forall b \in 1 \dots NTables$


\subsection{Enforce change time.}

\subsubsection{Subjective category $n$ to all other subjective categories}
$sy_{t}^{i,n} + sy_{t+u}^{i,d} \le 1$
\hfill $\forall i \in N,
\forall n \in 1 \dots NSubjective, 
d \in 1 \dots NSubjective \wedge d \neq n,
0 \le u \le \alpha^{subjective_{n}} + ct$

\subsubsection{Subjective category $n$ to all performance stations}
$sy_{t}^{i,n} + py_{t+u}^{i,b,s} \le 1$
\hfill $\forall i \in N,
\forall n \in 1 \dots NSubjective, 
\forall b \in 1 \dots NTables,
\forall s \in 1 \dots 2,
0 \le u \le \alpha^{subjective_{n}}+ ct,$

\subsubsection{Performance on table $b$ side $s$ to all other performance stations}
$py_{t}^{i,b,s} + py_{t+u}^{i,d,e} \le 1$
\hfill $\forall i \in N,
\forall b \in 1 \dots NTables,
\forall s \in 1 \dots 2,
\forall d \in 1 \dots NTables \wedge d \neq b,
\forall e \in 1 \dots 2 \wedge e \neq s,
0 \le u \le \alpha^{performance}+ ct$

\subsubsection{Performance on table $b$ side $s$ to all subjective stations}
$py_{t}^{i,b,s} + sy_{t+u}^{i,n} \le 1$
\hfill $\forall i \in N,
\forall b \in 1 \dots NTables,
\forall s \in 1 \dots 2,
\forall n \in 1 \dots NSubjective
0 \le u \le \alpha^{performance}+ ct$


\subsection{Enforce performance change time.}
$
\sum\limits_{b=1}^{NTables} (py_{t}^{i,b,1} + py_{t}^{i,b,2})
+
\sum\limits_{b=1}^{NTables} (py_{t+u}^{i,b,1} + py_{t+u}^{i,b,2}) 
\le 1$
\hfill $\forall i \in N, 
0 \le u \le \alpha^{performance} + pct$


\subsection{Make sure both sides of a table are always used if one side is
  used.}
$py_{t}^{i,b,1} - py_{t}^{i,b,2} \le 0$
\hfill $\forall i \in N,
\forall b \in 1 \dots NTables$


\subsection{Each team must be judged in all categories.}
$\sum\limits_{t \in T} ( 
    \sum\limits_{n=1}^{NSubjective} sz_{t}^{i,n}  
 + \sum\limits_{b=1}^{NTables} (pz{t}^{i,b,1} + pz{t}^{i,b,2})
)
= NSubjective + NRounds$
\hfill $\forall i \in N$


\subsection{Judging groups}
Each team is only judged at the subjective stations for their judging
group. This is handled by only constraining teams in the appropriate
judging group to the appropriate judging station. See \autoref{judging_group_constraint}


\section{Breaks}
\subsection{Start the performance rounds 60 minutes into the day.}
$\sum\limits_{i \in N} \sum\limits_{b=1}^{NTables} 
    \sum\limits_{t = 1}^{60/TInc} 
      ( py_{t}^{i,b,1} + py_{t}^{i,b,2} ) = 0$

\subsection{Other Breaks}
Need to add in lunch breaks for subjective and a break after the first few
performance runs. \jpscomment{Not sure how I want to do this yet.}

\section{Objective function}
Make everything as early as possible.

$Min ( 
\sum\limits_{t \in T}
  \sum\limits_{i \in N} (
    \sum\limits_{n=1}^{NSubjective}
      ( sy_{t}^{i,n} \times t )
  + \sum\limits_{b=1}^{NTables} ( ( py_{t}^{i,b,1} + py_{t}^{i,b,2} )
  \times t)
  )
) $

\end{document}
